"""
pymodbus documentation
Asyncronous Server Example
https://pymodbus.readthedocs.io/en/v2.0.1/source/example/synchronous_server.html
"""

from pymodbus.server.sync import StartTcpServer
from pymodbus.device import ModbusDeviceIdentification
from pymodbus.datastore import ModbusSequentialDataBlock, ModbusSparseDataBlock
from pymodbus.datastore import ModbusSlaveContext, ModbusServerContext

def main():
    """
    """
    store = ModbusSlaveContext(\
        di=ModbusSequentialDataBlock(0, [17]*100), \
        co=ModbusSequentialDataBlock(0, [17]*100), \
        hr=ModbusSequentialDataBlock(0, [17]*100), \
        ir=ModbusSequentialDataBlock(0, [17]*100))

    context = ModbusServerContext(slaves=store, single=True)
    identity = ModbusDeviceIdentification()
    identity.VendorName = 'Pymodbus'
    identity.ProductCode = 'PM'
    identity.VendorUrl = 'http://github.com/riptideio/pymodbus/'
    identity.ProductName = 'Pymodbus Server'
    identity.ModelName = 'Pymodbus Server'
    identity.MajorMinorRevision = '1.5'

    StartTcpServer(context, identity=identity, address=("localhost", 502) )
    return

if( __name__ == "__main__" ):
    main()
